#:APT-CACHER:#
# distribution specific configuration
case "$distribution" in
  xenial|bionic|focal|jammy|noble)
    MIRRORSITE="http://archive.ubuntu.com/ubuntu/"
    # we need key id 40976EAF437D05B5
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
    # cowdancer is in universe
    COMPONENTS="main universe"
    # security and updates
    OTHERMIRROR="deb http://archive.ubuntu.com/ubuntu/ ${distribution}-updates main universe|deb-src http://security.ubuntu.com/ubuntu ${distribution}-security main universe"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}libeatmydata.so"
    ;;
  trusty)
    # lacks eatmydata package, so explicitly configure it
    MIRRORSITE="http://archive.ubuntu.com/ubuntu/"
    # we need key id 40976EAF437D05B5
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
    # cowdancer is in universe
    COMPONENTS="main universe"
    # security and updates
    OTHERMIRROR="deb http://archive.ubuntu.com/ubuntu/ ${distribution}-updates main universe|deb-src http://security.ubuntu.com/ubuntu ${distribution}-security main universe"
    # ensure it's unset
    unset LD_PRELOAD
    ;;
  precise)
    # lacks eatmydata package, so explicitly configure it
    # also EOL nowadays, so need other mirror
    MIRRORSITE="http://old-releases.ubuntu.com/ubuntu/"
    # we need key id 40976EAF437D05B5
    DEBOOTSTRAPOPTS=("${DEBOOTSTRAPOPTS[@]}" "--keyring=/usr/share/keyrings/ubuntu-archive-keyring.gpg")
    # cowdancer is in universe
    COMPONENTS="main universe"
    # security and updates
    OTHERMIRROR="deb http://old-releases.ubuntu.com/ubuntu/ ${distribution}-updates main universe|deb-src http://old-releases.ubuntu.com/ubuntu ${distribution}-security main universe"
    # ensure it's unset
    unset LD_PRELOAD
    ;;
  bullseye|bookworm|trixie)
    MIRRORSITE="http://deb.debian.org/debian"
    # security and updates
    OTHERMIRROR="deb http://security.debian.org/debian-security ${distribution}-security main"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}libeatmydata.so"
    ;;
  *)
    MIRRORSITE="http://deb.debian.org/debian"
    # package install speedup
    EXTRAPACKAGES="eatmydata"
    export LD_PRELOAD="${LD_PRELOAD:+$LD_PRELOAD:}libeatmydata.so"
    ;;
esac

case "$architecture" in
  arm64)
    MIRRORSITE=$(echo "${MIRRORSITE}" | sed 's#archive.ubuntu.com/ubuntu#ports.ubuntu.com#')
    OTHERMIRROR=$(echo "${OTHERMIRROR}" | sed 's#archive.ubuntu.com/ubuntu#ports.ubuntu.com#')
    OTHERMIRROR=$(echo "${OTHERMIRROR}" | sed 's#security.ubuntu.com/ubuntu#ports.ubuntu.com#')
    # fix for ports.ubuntu.com 302 to https via apt-cacher-ng
    if [ -n "${http_proxy}" ] ; then
      MIRRORSITE=$(echo "${MIRRORSITE}" | sed 's#http://#http://HTTPS///#g')
      OTHERMIRROR=$(echo "${OTHERMIRROR}" | sed 's#http://#http://HTTPS///#g')
    fi
  ;;
esac
